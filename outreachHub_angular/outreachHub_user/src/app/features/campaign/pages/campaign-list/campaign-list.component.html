<div class="campaigns-wrapper p-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4">
    <div>
      <h2 class="text-2xl font-semibold text-[var(--oh-text)]">Campaigns</h2>
      <p class="text-sm text-[var(--oh-text-2)]">
        Workspace:
        <strong *ngIf="currentWorkspace">
          {{ currentWorkspace.name || currentWorkspace.workspaceId }}
        </strong>
        <span *ngIf="!currentWorkspace" class="text-xs text-gray-500">No workspace selected</span>
      </p>
    </div>

    <button (click)="createCampaign()"
            [disabled]="!isEditor()"
            class="bg-[var(--oh-primary)] text-white px-4 py-2 rounded-lg font-medium shadow hover:shadow-md hover:bg-[var(--oh-primary-dark)] transition disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed">
      ＋ Create Campaign
    </button>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto bg-[var(--oh-surface)] rounded-xl shadow mt-4">
    <table class="w-full border border-[var(--oh-border)] rounded-lg overflow-hidden">
      <thead class="bg-[var(--oh-peach)] text-[var(--oh-primary-dark)]">
        <tr>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Status</th>
          <th class="px-4 py-2 text-left">Template</th>
          <th class="px-4 py-2 text-left">Tags</th>
          <th class="px-4 py-2 text-left">Audience</th>
          <th class="px-4 py-2 text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of campaigns" class="border-b border-[var(--oh-border)] hover:bg-[rgba(252,223,209,0.3)] transition">
          <!-- Name -->
          <td class="px-4 py-2 font-medium">{{ c.name }}
            <div class="text-xs text-gray-500">{{ c.description }}</div>
          </td>

          <!-- Status -->
          <td class="px-4 py-2">
            <span class="px-2 py-1 rounded-full text-xs"
                  [ngClass]="{
                    'bg-[var(--oh-primary)]/20 text-[var(--oh-primary-dark)]': c.status === 'Draft',
                    'bg-green-100 text-green-700': c.status === 'Running',
                    'bg-gray-200 text-gray-700': c.status === 'Completed'
                  }">
              {{ c.status }}
            </span>
          </td>

          <!-- Template -->
          <td class="px-4 py-2 text-sm">{{ getTemplateName(c) }}</td>

          <!-- Tags -->
          <td class="px-4 py-2">
            <ng-container *ngIf="c.selectedTags?.length; else noTags">
              <span *ngFor="let t of c.selectedTags"
                    class="inline-block bg-[var(--oh-peach)] text-[var(--oh-primary-dark)] text-xs font-medium px-3 py-1 rounded-full mr-2 shadow-sm">
                {{ t }}
              </span>
            </ng-container>
            <ng-template #noTags><span class="text-xs text-gray-400">—</span></ng-template>
          </td>

          <!-- Audience -->
          <td class="px-4 py-2 text-sm">
            <button (click)="viewAudience(c)" class="text-blue-600 underline">
              {{ c.audienceCount ?? 0 }}
            </button>
          </td>

          <!-- Actions -->
          <td class="px-4 py-2 text-right space-x-3">
            <button (click)="viewCampaign(c._id)" class="px-3 py-1 rounded-lg font-medium text-white shadow bg-[var(--oh-navy)] hover:bg-[var(--oh-teal)] transition">View</button>
            <button (click)="editCampaign(c._id)" [disabled]="!isEditor()" class="px-3 py-1 rounded-lg font-medium text-white shadow bg-[var(--oh-navy)] hover:bg-[var(--oh-teal)] transition disabled:bg-gray-300">Edit</button>
            <button (click)="deleteCampaign(c._id)" [disabled]="!isEditor()" class="px-3 py-1 rounded-lg font-medium text-white shadow bg-[var(--oh-primary-dark)] hover:bg-[var(--oh-primary)] transition disabled:bg-gray-300">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty -->
    <div *ngIf="!campaigns?.length" class="text-center py-20 text-gray-500">
      No campaigns found for this workspace.
    </div>
  </div>
</div>
<app-audience-modal 
  [open]="audienceModalOpen" 
  [contacts]="audienceContacts"
  (close)="closeAudienceModal()">
</app-audience-modal>

